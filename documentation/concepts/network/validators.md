---
id: validators 
title: バリデータ
sidebar_label: バリデータ
---

### ネットワークにおけるバリデータノードの役割

Aleo ネットワークのバリデータノードはコンセンサスネットワークを形成し、Aleo Byzantine Fault Tolerance（[AleoBFT](./consensus.md)）コンセンサスプロトコルを通じてブロック生成を決定します。バリデータは `AleoCredits` をステークすることで投票権を獲得し、その投票権はステーク量に比例します。AleoBFT により、新しいブロックは誠実なバリデータの 3 分の 2 を超える承認を得た場合にのみ確定し、ネットワークの安全性が担保されます。ブロックが形成されると `finalized` 状態となり、そのブロックと含まれるトランザクションが巻き戻されることはありません。

### バリデータの経済的インセンティブ

AleoBFT の仕組みにより、悪意あるノードがネットワークを攻撃しようとすると、新しいブロックの生成を止めるには投票権の少なくとも 3 分の 1 を確保する必要があります。つまり、ネットワーク全体でステークされる `AleoCredits` が多いほどコンセンサスネットワークは堅牢になります。バリデータが `AleoCredits` をステークする動機づけとして、生成される各ブロックには `BlockReward` が含まれており、バリデータは自分がステークした割合に応じて報酬を受け取ります。

### バリデータになるには

バリデータノードになるためには最低 10,000,000（1,000 万）`AleoCredits` をステークする必要があります。ステーキングトランザクションがコンセンサスネットワークに受理されると、新しいバリデータは即座にコンセンサスへ参加し、Narwhal/Bullshark から改良された AleoBFT のおかげで直ちに `BlockReward` を獲得できます。

保有する `AleoCredits` が少額の場合は独立したバリデータにはなれませんが、委任を通じてステーキングに参加することが可能です。

バリデータノード同士はステータス情報を取得するために相互通信を行うため、ノード数が増えるほど通信量が増大し、通信の複雑性は `O(n)` に比例して大きくなります。通信量の増加はブロック生成時間の延長につながるため、Aleo ネットワークでは分散性と効率のバランスを取る目的でバリデータノード数を最大 200 に制限しています。

### 委任ステーキング

委任ステーキングでは、ユーザーがプログラム（Aleo のスマートコントラクト）を通じて特定のバリデータに `AleoCredits` をステークできます。ステークによって獲得した投票権も該当バリデータに委任されます。ユーザーはステーク量に応じて `BlockReward` を受け取り、バリデータは `Program` 内で設定された割合の手数料を徴収できます。複数のウォレットやブロックエクスプローラが委任機能を提供しており、UI 上で各バリデータの手数料率を確認しながら容易にステーキングを行えます。

ユーザーはいつでもステークを解除でき、解除後 360 ブロックが経過すると返還された `AleoCredits` を残高として受け取れます。

### バリデータがトランザクション／ソリューションを確定する仕組み

![image-20240422165659999](./images/validator-process-transaction.png)

バリデータノードがトランザクションおよびソリューションを確定する流れは次のとおりです。

- トランザクションやソリューションは P2P ネットワークまたは RPC を通じてバリデータのメモリプールに流入します。
- バリデータはメモリプールから一部を選択し、トランザクション／ソリューションに加えて前ラウンドの `2f + 1` 個の `BatchCertificate` を含む `BatchPropose` を作成し、他のバリデータへブロードキャストします。
- 受信したバリデータは `BatchPropose` の正当性を検証し、署名して `BatchSignature` を生成し、送信元バリデータへ返送します。
- 送信元バリデータが `2f + 1` 個を超える `BatchSignature` を受け取ると、それらを集約して `BatchCertificate` を作成し、再び他のバリデータへブロードキャストします。
- すべてのノードがこのプロセスを繰り返すことで `BatchCertificate` による DAG が形成されます。DAG がコミットされると新しいブロックが生成され、トランザクションとソリューションがそのブロックへ組み込まれます。

![image-20240422175911657](./images/Illustration_DAG.png)
