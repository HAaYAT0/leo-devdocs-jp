---
id: public_private 
title: 公開ステートと秘匿ステート
sidebar_label: 公開ステートと秘匿ステート
---

## はじめに
<!-- markdown-link-check-disable -->
ゼロ知識証明の概念は 1985 年、論文 [The Knowledge Complexity of Interactive Proof Systems](https://epubs.siam.org/doi/10.1137/0218012?utm_source=the+new+stack&utm_medium=referral&utm_content=inline-mention&utm_campaign=tns+platform) で初めて提案されました。とはいえ、この画期的な技術がブロックチェーンに応用できる現実的な姿になったのは、ここ数年のことです。 
<!-- markdown-link-check-enable -->


Zcash はゼロ知識証明によってアカウント残高のプライバシーを提供した最初期のチェーンのひとつです。トランザクションの詳細がブロックチェーン上で公開される Bitcoin などの従来型暗号資産と異なり、Zcash ではトランザクションを外部から完全に見えない状態にできます。これを支えるのが zk-SNARK（Zero-Knowledge Succinct Non-Interactive Argument of Knowledge）と呼ばれるゼロ知識証明の一種で、基となるデータを公開することなく計算の正当性を検証できます。 

近年では、Ethereum のスケーラビリティ問題を解決するため、ゼロ知識暗号技術を採用した EVM 互換のレイヤー 2 チェーンが複数登場しています。これらは zk-rollup を用い、複数の状態遷移をオフチェーンでまとめて計算し、その要約と証明をオンチェーンに投稿します。この仕組みにより、トランザクション手数料を大幅に削減できますが、ゼロ知識技術の主目的はあくまでスケーラビリティである場合がほとんどです。

Aleo は、汎用プログラマビリティとデフォルトのプライバシーを兼ね備えた新しいレイヤー 1 ブロックチェーンです。他のチェーンと異なり、Aleo はプライバシーとスケーラビリティの両方でゼロ知識を活用する、初期の取り組みのひとつです。 


## プライバシー
ブロックチェーンにおけるプライバシーは一般的に 4 つの側面に分類され、Aleo はそのうち 3 つを満たします。
- [x] 秘匿入力（メッセージ）
- [x] 秘匿出力（状態遷移）
- [x] 秘匿ユーザー
- [ ] 秘匿関数 

Aleo の根本的な考え方は、ブロックチェーンが社会に広く受け入れられるにはプライバシーが不可欠だということです。例えば、誰でも自分の銀行口座番号と取引履歴を追跡できるとしたら、どれほどの人が安心して利用できるでしょうか。

## Aleo のステートストレージ 
チェーンにプライバシーを組み込むため、Aleo は Bitcoin の UTXO モデルに似たレコードモデルでアプリケーションステートを保存します。ただし、必要に応じてステートを公開できるよう、開発者に選択肢を提供しています。公開ステートは Ethereum と同様にアカウントモデルで管理されます。 

### レコードによる秘匿ステートの保存
レコードは任意のペイロードを保持できる基本データ構造で、ユーザー資産やアプリケーションステートをエンコードします。例えば、アカウントの残高や身分証明書など、プログラムの特定の状態をグローバルステート上に表現します。 


Aleo レコードは次の形式でシリアライズされます。

| パラメーター  |             型             | 説明                                                                                         |
|------------|:----------------------------:|-----------------------------------------------------------------------------------------------------|
|     owner    |            address           |                      プログラムレコード所有者のアドレス公開鍵                      |
|    data    |    `map`   | 任意のアプリケーション依存情報を含むデータペイロード                               |
|    nonce   |             group            |                            プログラムレコードのシリアルナンセ                            |

レコードは Aleo 上にデプロイされたプログラムに紐づき、ステートを変更できるのは所有者だけです。

レコードはデフォルトで秘匿され、暗号文としてオンチェーンに保存されます。暗号化の詳細は [出力レコード](./04_transitions.md#output-record) を参照してください。

### マッピングによる公開ステートの保存

Aleo における公開ステートはキーと値のペアで構成されるマッピングとして保存されます。Aleo ブロックチェーンエクスプローラを通じて誰でもマッピングの状態を照会できます。

### プライバシーステートの切り替え
Aleo は秘匿と公開の両方のストレージをサポートしているため、ステートを秘匿から公開へ、またはその逆に変換できる柔軟性があります。

例えばポーカーゲームでは、プレイヤーにカードを配った直後のシャッフル済みデッキの状態は秘匿に保つべきですが、進行に応じて「フロップ」で公開する 3 枚のカードの状態は段階的に公開に切り替える必要があります。

### ビューキー
Aleo では各アカウントにビューキーというユニークな鍵が存在します。ビューキーを使うと、そのアカウントで行われたすべてのトランザクションを復号できます。秘密鍵と異なり、ビューキーにはレコードを消費する権限はありません。

## プログラムの秘匿入力と秘匿出力
保存されているプログラムステートだけでなく、関数の入力・出力も秘匿または公開を選択できます。以下は、2 つの入力値を加算し、その結果を `sum` というレコードに格納する Aleo プログラムの例です。開発者はトランジション関数の入力を公開にするか秘匿にするか指定でき、レコード内の各フィールドも `public` 修飾子で公開するかどうかを決められます。Aleo ではデフォルトが秘匿なので、修飾子を付けなければ秘匿となります。

<!-- ```
function foo:
    input r0 as field.public;
    input r1 as field.private;
    add r0 r1 into r2;
    output r2 as field.private;
``` -->

```
program sum.aleo {
    record sum {
        public owner: address,
        amount: u64,
    }

    transition main(public a: u64, b: u64) -> sum {
        let c: u64 = a + b;
        return sum {
            owner: self.caller,
            amount: c,
        };
    }
}
```

秘匿入力と秘匿出力の暗号化方法については[こちら](./04_transitions.md#non-record-ciphertext)を参照してください。

## 公開ステートと秘匿ステートの使い分け

アプリケーションステートを公開するか秘匿にするかは、プログラムのユースケースに応じて選択するべきです。完全に秘匿または完全に公開という極端なモデルではなく、開発者に選択肢を提供するハイブリッドアプローチを採用している点が Aleo の特徴です。

Aleo のモデルは、公開情報と秘匿情報を組み合わせて扱う実世界のアプリケーションに適しています。

具体的な例として投票があります。Aleo の創業者 Howard Wu が述べているように、「選挙では人々は投票したいが、どの候補に投票したかは他人に知られたくない。一方で、投票結果を理解するには開票結果が公開される必要がある」。個々の投票を秘匿しつつ集計結果を公開できる機能は、ここで述べたようなアプリケーションにおいて強力です。


## まとめ
Aleo はプログラマブルなプライバシーを重視するレイヤー 1 ブロックチェーンの草分けの一つです。開発者はプログラムの特定のステートを公開にするか秘匿にするかを自由に選択でき、他のブロックチェーンでは実現が難しい新しいタイプのアプリケーションを可能にします。今後の展開が非常に楽しみなチェーンと言えるでしょう。
