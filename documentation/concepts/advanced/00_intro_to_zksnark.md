---
id: intro_to_zksnark
title: zkSNARK 入門
sidebar_label: zkSNARK 入門
---

このセクションでは、zk 証明の基本的な考え方を概説し、zkSNARK を構成する手順を整理しながら、主に証明者と検証者という zk 証明の登場人物を定義します。また、証人、内部表現、トラステッドセットアップ、構造化参照文字列、ランダムオラクルといった zk 証明を構成する要素を紹介します。さらに、Aleo において zkSNARK 証明がどのような場面で使われるのかという背景も説明します。

## はじめに

高校などで触れる従来の証明システムでは、こちらが特定の情報を持っていることを示すために、検証者へ証拠を提示します。しかし多くの場合、その過程で情報自体を開示する必要があり、セキュリティ上の懸念が生じます。これに対してゼロ知識（Zero-Knowledge, ZK）証明は、証明者と検証者のどちらも相手を全面的には信頼しない状況を前提とすることで、この問題を解決します。検証者は証明者が本当に情報を持っているのかを信用せず、証明者は検証者が情報を秘密にしてくれるかを信用しません。一見すると克服不可能な課題に見えますが、数学と暗号の力によって解決策が生み出されました。それが zkSNARK（Zero-Knowledge Succinct Non-Interactive Argument of Knowledge）です。zkSNARK は、実際に情報を開示することなく、その情報を保有していると証明できる革新的な暗号技術です。

### 用語を分解してみましょう

- Zero-Knowledge: ゼロ知識の状況では、証明者も検証者も、本来知るべき範囲を超える情報を新たに得ることはありません。検証者は証明者が主張する情報を確かに持っていると確信し、証明者は具体的な内容を明かすことなく知識を示します。
- Succinct: 証明者が生成する証明は非常にコンパクトで、ネットワーク上で配布しやすく、検証に必要な計算資源も最小限に抑えられます。
- Non-Interactive: 証明と検証の過程で、証明者と検証者のやり取りがほとんど発生せず、効率的なプロセスになります。

## 仕組みはどのようになっているのでしょうか

ブロックチェーンにおいて、zkSNARK はスケーラビリティを高める役割とプライバシーを強化する役割の両方を担います。分かりやすく説明すると、zkSNARK は証明者（たとえばアリス）と 1 人以上の検証者（たとえばボブ）との間で成り立つ証明システムです。以下のような場面で活用されます。

1. 証明者は秘匿すべき情報を持っているものの、その内容を明かさずに検証者へ所有していることを納得させたい場合。たとえば、ユーザーが成人年齢（18 歳以上）を満たしていることだけを証明し、実際の年齢は公開しないケースが挙げられます。
2. 別の場面では、証明者が検証者から処理を依頼されるスーパーコンピュータである場合があります。検証者は証明者を完全には信用できないため、計算が忠実に実行され、改ざんされていないことを保証する必要があります。この用途はスケーラビリティや計算の正当性を保つうえで重要です。たとえば ZK ロールアップ（Layer 2）では、zkSNARK を利用して、前回のロールアップ以降のトランザクションが正しく実行されたことを Layer 1（主に Ethereum）へ証明します。

これらのシナリオを ZK 証明として定式化するには、以下の手順に従います。

1. 証明したい主張を表すコードを作成します。最初の例であれば、入力（年齢など）を受け取り、18 を超えているかを比較し、真偽値を返すコードです。2 つ目の例では、シーケンサーに似たコードになります。シーケンサーは L2 システムの現在の状態を受け取り、入ってきたトランザクションを順に並べて指定された順序で実行し、その結果として新しい状態を出力します。
2. 次に、作成したコードを線形因子と商多項式で表現される多項式へ変換します。任意のプログラムをこの形式の多項式へ変換する数学的手法が研究コミュニティで確立されています。Aleo で用いられているこの手順については、後ほどドキュメント内の例を通じて説明します。要点となるステップは以下のとおりです。
   
    1. フラッテン：コードを論理ゲート表現へ変換します。
    2. R1CS：フラッテンした形式をランク 1 制約システム（R1CS）へ変換します。各論理ゲートが 1 つの制約を表しており、最終結果が正しいためにはすべての制約が正しく満たされる必要があります。各論理ゲートの出力が証人（witness）になります。（PLONK や AIR など、他にもよく使われる中間的な算術表現があります。）
    3. QAP：二次算術プログラム（Quadratic Arithmetic Program）で、R1CS が定めるすべての制約を 1 つの制約へと集約し、zk 証明の検証を大幅に単純化します。

    証人とは、証明者が証明とともに提供する追加情報のことを指します。この情報が、証明対象となる主張が真であることを裏づける役割を担います。検証者は、内部の詳細を知ることなく証明の正しさを確認するための補強証拠として利用します。

 3. zkSNARK では、証明者と検証者がトラステッドセットアップと呼ばれる手続きに参加する必要があります。ここで証明者は、検証者たちが選んだ値に対して構築された多項式の評価値をコミットします。これにより証明者が正しい多項式を使っていることが保証され、不正ができなくなります。
 4. 準備が整ったら、実際に証明を生成・やり取りし、検証を行います。zk 証明システムは確率的に動作するため、検証者の確信度は満たされた検証回数に比例して高まります。やり取りを極力減らしながらこの交換を実現するために、インタラクティブランダムオラクルを利用して、証明者と検証者が一度のやり取りで通信できるようにし、改ざんされた証明が通ってしまう確率を無視できるレベルまで低下させます。（KZG のようなコミットメント方式を採用する証明システムもあります。）


この先のセクションでは、完全なプライバシーを実現するために Aleo が実装しているプロトコルを詳しく見ていきます。その前に、ゼロ知識証明（ZKP）が Aleo のプライバシー機能にどのように貢献しているのかを理解しておくことが重要です。

Aleo は完全に秘匿されたブロックチェーンとして動作しており、ユーザーのアカウント状態全体が秘密に保たれ、ユーザー本人（およびそのユーザーのビュ―キーを知らない者）以外はアクセスできません。それでもユーザーはブロックチェーン上でトランザクションを行い、ネットワークの合意を得られる新しい状態へと遷移する必要があります。これを実現するために、Aleo は合意対象となる機微なユーザーデータをすべて「レコード」として扱います。ユーザーがトランザクションを行うたびに、入力として使われたレコードは失効し、新しいプライベートレコードが生成されて最新の状態を表します。各トランザクションでは、新しいレコードを正しく生成したことを保証するために zk 証明が作成されます。生成されたレコードは暗号化され、作成証明とともにチェーン上へ保存されます。これによりプライバシーは保たれつつ、証明の検証を通じてネットワーク側が正当性を確認できます。




	
